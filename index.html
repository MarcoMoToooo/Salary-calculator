<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Payroll Calculator ni Marco</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="text-slate-100"
      style="background: url('Official wallpaper 2.png') no-repeat center center fixed;
             background-size: cover;
             width: 1920px; 
             height: 1080px;">

  <div class="max-w-6xl mx-auto p-6 bg-slate-900/70 rounded-2xl">
    <header class="mb-6">
      <h1 class="text-2xl font-bold">Payroll Calculator ni Marco</h1>
      <p class="text-slate-400">Tamad ka mag compute? Eto na.</p>
    </header>

<!-- ====== INPUTS ====== -->
<section class="bg-slate-800/60 border border-slate-700 rounded-2xl p-5 mb-6">
  <h2 class="text-lg font-semibold mb-4">Inputs</h2>
  <div class="grid md:grid-cols-3 gap-4">
    <div>
      <label class="block text-sm text-slate-400 mb-1">Basic Salary</label>
      <input id="basicSalary" type="number" step="0.01" class="w-full rounded-xl bg-slate-900 border border-slate-700 p-3" placeholder="e.g. 19000"/>
    </div>
    <div>
      <label class="block text-sm text-slate-400 mb-1">Non-tax Allowance</label>
      <input id="allowance" type="number" step="0.01" class="w-full rounded-xl bg-slate-900 border border-slate-700 p-3" placeholder="e.g. 3000"/>
    </div>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm text-slate-400 mb-1">Month</label>
        <select id="month" class="w-full rounded-xl bg-slate-900 border border-slate-700 p-3"></select>
      </div>
      <div>
        <label class="block text-sm text-slate-400 mb-1">Year</label>
        <input id="year" type="number" class="w-full rounded-xl bg-slate-900 border border-slate-700 p-3"/>
      </div>
    </div>
    <div>
      <label class="block text-sm text-slate-400 mb-1">Role</label>
      <select id="role" class="w-full rounded-xl bg-slate-900 border border-slate-700 p-3">
        <option value="analyst" selected>Analyst</option>
        <option value="manager">Manager (TL)</option>
      </select>
    </div>
    <div>
      <label class="block text-sm text-slate-400 mb-1">SSS Loan</label>
      <input id="sssLoan" type="number" step="0.01" class="w-full rounded-xl bg-slate-900 border border-slate-700 p-3" value="0"/>
    </div>
    <div>
      <label class="block text-sm text-slate-400 mb-1">Pag-Ibig Loan</label>
      <input id="pagibigLoan" type="number" step="0.01" class="w-full rounded-xl bg-slate-900 border border-slate-700 p-3" value="0"/>
    </div>
    <div>
      <label class="block text-sm text-slate-400 mb-1">UnionBank Loan</label>
      <input id="unionbankLoan" type="number" step="0.01" class="w-full rounded-xl bg-slate-900 border border-slate-700 p-3" value="0"/>
    </div>

    <!-- FIX: Region + Loan Cutoff aligned -->
    <div class="grid grid-cols-2 gap-4 md:col-span-2">
      <div>
        <label class="block text-sm text-slate-400 mb-1">Region Time Zone</label>
        <select id="region" class="w-full rounded-xl bg-slate-900 border border-slate-700 p-3">
          <option value="East Coast">East Coast</option>
          <option value="South Central">South Central</option>
          <option value="West Coast">West Coast</option>
          <option value="East Coast - DST">East Coast - DST</option>
          <option value="South Central - DST">South Central - DST</option>
          <option value="West Coast - DST">West Coast - DST</option>
        </select>
      </div>
      <div>
        <label class="block text-sm text-slate-400 mb-1">Loan Deduction Cutoff</label>
        <select id="loanCutoff" class="w-full rounded-xl bg-slate-900 border border-slate-700 p-3">
          <option value="1" selected>Cutoff 1</option>
          <option value="2">Cutoff 2</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Cutoffs -->
  <div class="mt-6 grid md:grid-cols-2 gap-6">
    <!-- Cutoff 1 -->
    <div class="bg-slate-900/60 border border-slate-700 rounded-2xl p-4">
      <div class="flex items-center justify-between mb-3">
        <h3 class="font-semibold">Cutoff 1: 1st–15th</h3>
        <div class="text-xs text-slate-400">Business days: <span id="co1Days" class="font-semibold text-slate-200">0</span></div>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="block text-xs text-slate-400 mb-1">Days Present</label>
          <input id="c13" type="number" step="1" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
        <div class="analyst-only">
          <label class="block text-xs text-slate-400 mb-1">Special Holidays</label>
          <input id="e13" type="number" step="1" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
        <div class="analyst-only">
          <label class="block text-xs text-slate-400 mb-1">Official Holidays</label>
          <input id="f13" type="number" step="1" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
        <div>
          <label class="block text-xs text-slate-400 mb-1">Minutes Late</label>
          <input id="g13" type="number" step="1" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
        <div class="col-span-2 analyst-only">
          <label class="block text-xs text-slate-400 mb-1">Overtime Hours</label>
          <input id="h13" type="number" step="0.01" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
		 <div>
          <label class="block text-xs text-slate-400 mb-1">PTO / VL / SL (days)</label>
          <input id="pto1" type="number" step="1" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
      </div>
    </div>

    <!-- Cutoff 2 -->
    <div class="bg-slate-900/60 border border-slate-700 rounded-2xl p-4">
      <div class="flex items-center justify-between mb-3">
        <h3 class="font-semibold">Cutoff 2: 16th–End</h3>
        <div class="text-xs text-slate-400">Business days: <span id="co2Days" class="font-semibold text-slate-200">0</span></div>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="block text-xs text-slate-400 mb-1">Days Present</label>
          <input id="c14" type="number" step="1" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
        <div class="analyst-only">
          <label class="block text-xs text-slate-400 mb-1">Special Holidays</label>
          <input id="e14" type="number" step="1" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
        <div class="analyst-only">
          <label class="block text-xs text-slate-400 mb-1">Official Holidays</label>
          <input id="f14" type="number" step="1" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
        <div>
          <label class="block text-xs text-slate-400 mb-1">Minutes Late</label>
          <input id="g14" type="number" step="1" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
        <div class="col-span-2 analyst-only">
          <label class="block text-xs text-slate-400 mb-1">Overtime Hours</label>
          <input id="h14" type="number" step="0.01" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
		<div>
          <label class="block text-xs text-slate-400 mb-1">PTO / VL / SL (days)</label>
          <input id="pto2" type="number" step="1" class="w-full rounded-xl bg-slate-800 border border-slate-700 p-3" />
        </div>
      </div>
    </div>
  </div>

  <!-- Buttons -->
  <div class="mt-4 flex gap-3">
    <button id="calcBtn" class="px-5 py-3 rounded-xl bg-cyan-400 text-slate-900 font-semibold">Calculate Payroll</button>
    <button id="resetBtn" class="px-5 py-3 rounded-xl bg-transparent border border-slate-600">Reset</button>
  </div>
</section>

<!-- ====== RESULTS ====== -->
<section class="grid md:grid-cols-5 gap-4 mb-6">
  <div class="bg-slate-800/60 border border-slate-700 rounded-2xl p-4">
    <div class="text-sm text-slate-400">Salary (15th)</div>
    <div id="res15" class="text-3xl font-bold">₱0.00</div>
  </div>
  <div class="bg-slate-800/60 border border-slate-700 rounded-2xl p-4">
    <div class="text-sm text-slate-400">Salary (30th)</div>
    <div id="res30" class="text-3xl font-bold">₱0.00</div>
  </div>
  <div class="bg-slate-800/60 border border-slate-700 rounded-2xl p-4">
    <div class="text-sm text-slate-400">Monthly Total</div>
    <div id="resMonth" class="text-3xl font-bold">₱0.00</div>
  </div>
  <div class="bg-slate-800/60 border border-slate-700 rounded-2xl p-4">
    <div class="text-sm text-slate-400">Business Days (Month)</div>
    <div id="totalDays" class="text-3xl font-bold">0</div>
  </div>
  <div class="bg-slate-800/60 border border-slate-700 rounded-2xl p-4">
    <div class="text-sm text-slate-400">13th Month Pay (Monthly Portion)</div>
    <div id="res13th" class="text-3xl font-bold">₱0.00</div>
  </div>
</section>

<!-- ====== BREAKDOWN ====== -->
<section class="bg-slate-800/60 border border-slate-700 rounded-2xl p-5">
  <h2 class="text-lg font-semibold mb-4">Breakdown</h2>
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <h3 class="font-semibold mb-2">Helper Rates</h3>
      <ul class="text-sm text-slate-300 space-y-1">
        <li>Daily Rate: <span id="m5"></span></li>
        <li>Hourly Rate: <span id="m6"></span></li>
        <li class="analyst-only">Night Diff Rate: <span id="m7"></span></li>
        <li>Daily Allowance: <span id="m8"></span></li>
        <li>Cutoff Salary: <span id="m9"></span></li>
        <li>Cutoff Allowance: <span id="m10"></span></li>
        <li>Per-Minute Deduction: <span id="m11"></span></li>
        <li>Absences (Month): <span id="absences"></span></li>
      </ul>
    </div>
    <div>
      <h3 class="font-semibold mb-2">Contributions (deducted on 2nd cutoff)</h3>
      <ul class="text-sm text-slate-300 space-y-1">
        <li>SSS (Employee): <span id="sss"></span></li>
        <li>PhilHealth: <span id="ph"></span></li>
        <li>Pag-IBIG: <span id="pi"></span></li>
        <li>Withholding Tax: <span id="tax"></span></li>
        <li>Total Contributions: <span id="e9"></span></li>
      </ul>
    </div>
  </div>
</section>
<script>
window.addEventListener('DOMContentLoaded', () => {
  try {
    // ---------- Helper utilities ----------
    function safeEl(id){ return document.getElementById(id) || null; }
    function safeNum(id){ const e = safeEl(id); return e ? Number(e.value || 0) : 0; }
    function safeVal(id, def = ''){ const e = safeEl(id); return e ? e.value : def; }
    function setTextIf(id, text){ const e = safeEl(id); if(e) e.textContent = text; }

    function peso(n){ return `₱${(Number(n)||0).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}`; }

    function businessDaysInRange(year, month, startDay, endDay){
      let count = 0;
      for(let d=startDay; d<=endDay; d++){
        const dt = new Date(year, month-1, d);
        const day = dt.getDay();
        if(day !== 0 && day !== 6) count++;
      }
      return count;
    }
    function daysInMonth(year, month){ return new Date(year, month, 0).getDate(); }

    /* --- SSS TABLE (keep full original) --- */
    const SSS_TABLE = [
      {"min":0.0,"max":5250.0,"employee":250.0},{"min":5250.0,"max":5749.99,"employee":275.0},{"min":5750.0,"max":6249.99,"employee":300.0},{"min":6250.0,"max":6749.99,"employee":325.0},{"min":6750.0,"max":7249.99,"employee":350.0},{"min":7250.0,"max":7749.99,"employee":375.0},{"min":7750.0,"max":8249.99,"employee":400.0},{"min":8250.0,"max":8749.99,"employee":425.0},{"min":8750.0,"max":9249.99,"employee":450.0},{"min":9250.0,"max":9749.99,"employee":475.0},{"min":9750.0,"max":10249.99,"employee":500.0},{"min":10250.0,"max":10749.99,"employee":525.0},{"min":10750.0,"max":11249.99,"employee":550.0},{"min":11250.0,"max":11749.99,"employee":575.0},{"min":11750.0,"max":12249.99,"employee":600.0},{"min":12250.0,"max":12749.99,"employee":625.0},{"min":12750.0,"max":13249.99,"employee":650.0},{"min":13250.0,"max":13749.99,"employee":675.0},{"min":13750.0,"max":14249.99,"employee":700.0},{"min":14250.0,"max":14749.99,"employee":725.0},{"min":14750.0,"max":15249.99,"employee":750.0},{"min":15250.0,"max":15749.99,"employee":775.0},{"min":15750.0,"max":16249.99,"employee":800.0},{"min":16250.0,"max":16749.99,"employee":825.0},{"min":16750.0,"max":17249.99,"employee":850.0},{"min":17250.0,"max":17749.99,"employee":875.0},{"min":17750.0,"max":18249.99,"employee":900.0},{"min":18250.0,"max":18749.99,"employee":925.0},{"min":18750.0,"max":19249.99,"employee":950.0},{"min":19250.0,"max":19749.99,"employee":975.0},{"min":19750.0,"max":20249.99,"employee":1000.0},{"min":20250.0,"max":20749.99,"employee":1025.0},{"min":20750.0,"max":21249.99,"employee":1050.0},{"min":21250.0,"max":21749.99,"employee":1075.0},{"min":21750.0,"max":22249.99,"employee":1100.0},{"min":22250.0,"max":22749.99,"employee":1125.0},{"min":22750.0,"max":23249.99,"employee":1150.0},{"min":23250.0,"max":23749.99,"employee":1175.0},{"min":23750.0,"max":24249.99,"employee":1200.0},{"min":24250.0,"max":24749.99,"employee":1225.0},{"min":24750.0,"max":25249.99,"employee":1250.0},{"min":25250.0,"max":25749.99,"employee":1275.0},{"min":25750.0,"max":26249.99,"employee":1300.0},{"min":26250.0,"max":26749.99,"employee":1325.0},{"min":26750.0,"max":27249.99,"employee":1350.0},{"min":27250.0,"max":27749.99,"employee":1375.0},{"min":27750.0,"max":28249.99,"employee":1400.0},{"min":28250.0,"max":28749.99,"employee":1425.0},{"min":28750.0,"max":29249.99,"employee":1450.0},{"min":29250.0,"max":29749.99,"employee":1475.0},{"min":29750.0,"max":30249.99,"employee":1500.0},{"min":30250.0,"max":30749.99,"employee":1525.0},{"min":30750.0,"max":31249.99,"employee":1550.0},{"min":31250.0,"max":31749.99,"employee":1575.0},{"min":31750.0,"max":32249.99,"employee":1600.0},{"min":32250.0,"max":32749.99,"employee":1625.0},{"min":32750.0,"max":33249.99,"employee":1650.0},{min: 33250, max: 33749.99, employee: 1675},{min: 33750, max: 34249.99, employee: 1700},{min: 34250, max: 34749.99, employee: 1725}, {min: 34750, max: 10000000, employee: 1750}
    ];
    function sssEmployeeShare(monthlySalary){
      const s = Number(monthlySalary||0);
      for(const row of SSS_TABLE){
        if(s >= row.min && s <= row.max) return row.employee;
      }
      return SSS_TABLE[SSS_TABLE.length-1].employee;
    }

    /* --- TRAIN TAX BRACKETS --- */
    const TAX_BRACKETS = [
      {low:0, high:20833, base:0, rate:0.0, over:0},
      {low:20833, high:33332, base:0, rate:0.15, over:20833},
      {low:33333, high:66666, base:2500, rate:0.20, over:33333},
      {low:66667, high:166666, base:10833, rate:0.25, over:66667},
      {low:166667, high:666666, base:40833, rate:0.30, over:166667},
      {low:666667, high:999999999, base:200833, rate:0.35, over:666667},
    ];
    function monthlyTax(taxableMonthly){
      const s = Number(taxableMonthly||0);
      const br = TAX_BRACKETS.find(b => s >= b.low && s <= b.high) || TAX_BRACKETS[TAX_BRACKETS.length-1];
      return br.base + (s - br.over) * br.rate;
    }

    // Region → Night Differential hours mapping
    const regionNightDiff = {
      "East Coast": 7,
      "South Central": 7,
      "West Coast": 6,
      "East Coast - DST": 7,
      "South Central - DST": 7,
      "West Coast - DST": 5
    };

    // ---------- Main calculation (uses safeNum/safeVal) ----------
    function calc(){
      try {
        const B5 = safeNum('basicSalary');
        const B6 = safeNum('allowance');
        const year = Number(safeVal('year', new Date().getFullYear()));
        const month = Number(safeVal('month', new Date().getMonth()+1));
        const role = safeVal('role', 'analyst');
        const PTO1 = parseFloat(document.getElementById("pto1").value) || 0;
        const PTO2 = parseFloat(document.getElementById("pto2").value) || 0;
		
        // new loan inputs (safe)
        const sssLoan = safeNum('sssLoan');
        const pagibigLoan = safeNum('pagibigLoan');
        const unionbankLoan = safeNum('unionbankLoan');

        // loan cutoff selector (safe)
        const loanCutoff = safeVal('loanCutoff', '2'); // default to 2 if not present

        // region & NDH
        const region = safeVal('region','East Coast');
        const NDH = (regionNightDiff && regionNightDiff[region]) || 7;

        // business days
        const co1 = businessDaysInRange(year, month, 1, 15);
        const lastDay = daysInMonth(year, month);
        const co2 = businessDaysInRange(year, month, 16, lastDay);
        setTextIf('co1Days', co1);
        setTextIf('co2Days', co2);
        setTextIf('totalDays', co1 + co2);

        // cutoff inputs (safe reads)
        const C13 = safeNum('c13'), E13 = safeNum('e13'), F13 = safeNum('f13'), G13 = safeNum('g13'), H13 = safeNum('h13');
        const C14 = safeNum('c14'), E14 = safeNum('e14'), F14 = safeNum('f14'), G14 = safeNum('g14'), H14 = safeNum('h14');
        const D13 = co1, D14 = co2;

        // helper rates
        const M5 = B5 / 21.6665944446851;
        const M6 = M5 / 8;
        const M7 = M6 * 0.10;
        const M8 = B6 / 2 / 12;
        const M9 = B5 / 2;
        const M10 = B6 / 2;
        const M11 = M6 / 60;

        // 13th month
        const totalPTO = PTO1 + PTO2;
        const absences = (co1 + co2) - (C13 + C14 + totalPTO);
        const thirteenth = (B5 - (absences * M5)) / 12;
        setTextIf('absences', absences);
        setTextIf('res13th', peso(thirteenth));

        // contributions
        const SSS = sssEmployeeShare(B5);
        const PhilHealth = B5 * 0.025;
        const PagIbig = 200;
        const taxableMonthly = Math.max(0, B5 - (SSS + PhilHealth + PagIbig));
        const WithholdingTax = monthlyTax(taxableMonthly);
        const E9 = SSS + PhilHealth + PagIbig + WithholdingTax;

        // Cutoff 1
        const absent1 = (D13 - C13);
        let co1_value = M9 - (absent1 * M5) + (M10 - (absent1 * M8)) - (G13 * M11);
        co1_value += PTO1 * M5;
        if (role === "analyst") {
          co1_value += (E13 * (M5 * 0.30)) + (E13 * (M7 * NDH * 0.30)) +
                       (F13 * M5) + (F13 * (M7 * NDH)) +
                       (M7 * NDH * C13) + (H13 * (M6 * 1.30));
        }
        // apply loans to cutoff 1 if selected
        if (loanCutoff === "1") {
          co1_value -= (sssLoan + pagibigLoan + unionbankLoan);
        }

        // Cutoff 2
        const absent2 = (D14 - C14);
        let co2_value = M9 - (absent2 * M5) + (M10 - (absent2 * M8)) - E9 - (G14 * M11);
        co2_value += PTO2 * M5;
        // apply loans to cutoff 2 if selected
        if (loanCutoff === "2") {
          co2_value -= (sssLoan + pagibigLoan + unionbankLoan);
        }
        if (role === "analyst") {
          co2_value += (E14 * (M5 * 0.30)) + (E14 * (M7 * NDH * 0.30)) +
                       (F14 * M5) + (F14 * (M7 * NDH)) +
                       (M7 * NDH * C14) + (H14 * (M6 * 1.30));
        }

        // update results UI
        setTextIf('res15', peso(co1_value));
        setTextIf('res30', peso(co2_value));
        setTextIf('resMonth', peso(co1_value + co2_value));

        // helper rates & contributions UI
        setTextIf('m5', peso(M5)); setTextIf('m6', peso(M6)); setTextIf('m7', peso(M7));
        setTextIf('m8', peso(M8)); setTextIf('m9', peso(M9)); setTextIf('m10', peso(M10)); setTextIf('m11', peso(M11));
        setTextIf('sss', peso(SSS)); setTextIf('ph', peso(PhilHealth)); setTextIf('pi', peso(PagIbig));
        setTextIf('tax', peso(WithholdingTax)); setTextIf('e9', peso(E9));
      } catch (err) {
        console.error("Error in calc():", err);
      }
    } // end calc()

    // ---------- Init: fill month dropdown if present ----------
    (function initMonthAndEvents(){
      try {
        const monthSel = safeEl('month');
        if(monthSel){
          monthSel.innerHTML = ''; // clear
          const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
          monthNames.forEach((m,i) => {
            const opt = document.createElement('option');
            opt.value = (i+1);
            opt.textContent = `${i+1} - ${m}`;
            monthSel.appendChild(opt);
          });
          monthSel.value = (new Date()).getMonth()+1;
        } else {
          console.warn('#month element not found — month dropdown not populated.');
        }
      } catch(e) { console.error('initMonth error', e); }

      // Bind calculate & reset safely
      const calcBtn = safeEl('calcBtn');
      if(calcBtn) calcBtn.addEventListener('click', calc);
      else console.warn('calcBtn not found — calculate button will not trigger.');

      const resetBtn = safeEl('resetBtn');
      if(resetBtn) resetBtn.addEventListener('click', () => location.reload());

      // Recompute whenever inputs change (optional but useful)
      document.querySelectorAll('input,select').forEach(el => {
      });

      // initial compute
      setTimeout(calc, 10);
    })();

  } catch (e) {
    console.error("Initialization error:", e);
  }
});
</script>
</body>
</html>
